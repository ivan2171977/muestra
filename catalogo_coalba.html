<!DOCTYPE html>
<html lang="es">
<head>
<link rel="icon" type="image/png" href="img/favicon.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo Colegio Albania</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root{ --brand:#0b3a74; --accent:#f4c20d; --bg:#f5f7fb; }
  html{ scroll-behavior:smooth; }
  body{ background:var(--bg); }
  .navbar{ background:var(--brand) !important; }
  .navbar .nav-link, .navbar .navbar-brand{ color:#fff !important; }
  .navbar .nav-link:hover{ color:var(--accent) !important; }
  .btn-primary{ background:var(--brand); border-color:var(--brand); }
  .btn-primary:hover{ background:#072a54; border-color:#072a54; }
  header.hero{ background:#fff; border-bottom:3px solid var(--accent); }
  header.hero h1{ color:var(--brand); }
  .card{ transition:transform .2s; cursor:pointer; }
  .card:hover{ transform:translateY(-3px); }
  .price{ color:#198754; font-weight:600; }
  .filters .form-select, .filters .form-control{ min-width:160px; }
  .logo-img{ height:48px; width:auto; display:block; }
  .cart-btn{ position:relative; }
  .cart-badge{
    position:absolute; top:-6px; right:-8px;
    background:var(--accent); color:#111; border-radius:999px;
    font-weight:700; font-size:11px; padding:2px 6px; display:none;
  }
  .dropdown-menu-cart{ min-width: 320px; max-height: 60vh; overflow:auto; }
</style>
</head>
<body id="top">
<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#top">
      <img src="img/LogoColegioAlbania-1024x358.png" class="logo-img" alt="Colegio Albania">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbars">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbars">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-2">
        <li class="nav-item"><a class="nav-link" href="#top">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="#contacto">Contáctanos</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link cart-btn dropdown-toggle" href="#" id="cartDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <img src="img/cart.png" alt="" style="height:22px;filter: brightness(0) invert(1);">
            <span id="cartCount" class="cart-badge">0</span>
          </a>
          <div class="dropdown-menu dropdown-menu-end dropdown-menu-cart p-0" aria-labelledby="cartDropdown">
            <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
              <strong>Carrito</strong>
              <small class="text-muted" id="cartPreviewCount">0 ítems</small>
            </div>
            <div id="cartPreviewList" class="list-group list-group-flush"></div>
            <div class="p-3 border-top">
              <div class="d-flex justify-content-between mb-2">
                <span>Total:</span>
                <strong id="cartPreviewTotal">$0</strong>
              </div>
              <div class="d-flex gap-2">
                <a href="checkout.html" class="btn btn-primary w-100">Ir a pagar</a>
                <button class="btn btn-outline-danger" onclick="clearCart()">Vaciar</button>
              </div>
            </div>
          </div>
        </li>
        <li class="nav-item"><a class="nav-link" href="#" id="loginNav">Iniciar sesión</a></li>
        <li class="nav-item d-none" id="sellerLink"><a class="nav-link" href="admin.html">Vendedor</a></li>
      </ul>
    </div>
  </div>
</nav>

<header class="hero">
  <div class="container py-4">
    <h1 class="h3 mt-1 mb-1">Catálogo institucional</h1>
    <p class="text-muted mb-0">Explora libremente. Para comprar, inicia sesión.</p>
  </div>
</header>

<main class="container py-4" id="catalogo">
  <div class="d-flex flex-wrap align-items-end gap-2 filters mb-4">
    <div>
      <label class="form-label mb-1">Sección</label>
      <select id="selL1" class="form-select form-select-sm">
        <option value="todos" selected>Todos</option>
        <option value="ropa">Ropa</option>
        <option value="libros">Libros</option>
      </select>
    </div>
    <div id="wrapGenero" style="display:none;">
      <label class="form-label mb-1">Género</label>
      <select id="selGenero" class="form-select form-select-sm">
        <option value="todos" selected>Todos</option>
        <option value="chica">Chica</option>
        <option value="chico">Chico</option>
      </select>
    </div>
    <div id="wrapSubcat" style="display:none;">
      <label class="form-label mb-1">Subcategoría</label>
      <select id="selSub" class="form-select form-select-sm">
        <option value="todos" selected>Todos</option>
        <option value="sudaderas">Sudaderas</option>
        <option value="camisas">Camisas</option>
        <option value="correas">Correas</option>
        <option value="zapatos">Zapatos</option>
      </select>
    </div>
    <div class="ms-auto flex-grow-1" style="min-width:220px;">
      <label class="form-label mb-1">Buscar por nombre</label>
      <input id="searchInput" type="search" class="form-control form-control-sm" placeholder="Ej: Sudadera, Camisa, Libro...">
    </div>
  </div>

  <div class="row g-4" id="grid"></div>

  <section class="container py-5" id="contacto">
    <h2 class="text-center mb-4">Contáctanos</h2>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <form class="card shadow-sm p-4 bg-white">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre</label>
              <input type="text" class="form-control" placeholder="Tu nombre">
            </div>
            <div class="col-md-6">
              <label class="form-label">Correo</label>
              <input type="email" class="form-control" placeholder="tucorreo@ejemplo.com">
            </div>
            <div class="col-12">
              <label class="form-label">Mensaje</label>
              <textarea class="form-control" rows="4" placeholder="Cuéntanos qué necesitas"></textarea>
            </div>
            <div class="col-12 text-end">
              <button type="button" class="btn btn-primary" disabled>Enviar (maqueta)</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>
</main>

<footer class="text-center py-3" style="background:#0b3a74;color:#fff;">
  © 2025 Colegio Albania — Maqueta de catálogo.
</footer>

<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Iniciar sesión</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div>
      
      <div class="modal-body">
        <div class="mb-3"><label class="form-label">Usuario</label><input id="loginUser" type="text" class="form-control" placeholder="Ej: admin o vendedor"></div>
        <div class="mb-2"><label class="form-label">Contraseña</label><input id="loginPass" type="password" class="form-control" placeholder="••••••••"></div>
        <div class="form-text">admin/admin → Admin · vendedor/vendedor → Vendedor · cualquier otro → Comprador</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" onclick="doUnifiedLogin()">Entrar</button>
      
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" onclick="doLogin()">Entrar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="common.js"></script>
<script>
  document.getElementById('loginNav').addEventListener('click', toggleLoginFromNav);
  refreshLoginNav();
  if (isSeller() && isLoggedIn()) document.getElementById('sellerLink').classList.remove('d-none');
  updateCartBadge();

  const ITEMS = [{"id": 1, "name": "Correa Chica 01", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 77098, "img": "item_001.png"}, {"id": 2, "name": "Sudadera Chica 02", "section": "ropa", "genero": "chica", "subcat": "sudaderas", "price": 133696, "img": "item_002.png"}, {"id": 3, "name": "Sudadera Chico 03", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 48905, "img": "item_003.png"}, {"id": 4, "name": "Camisa Chica 04", "section": "ropa", "genero": "chica", "subcat": "camisas", "price": 111237, "img": "item_004.png"}, {"id": 5, "name": "Zapatos Chica 05", "section": "ropa", "genero": "chica", "subcat": "zapatos", "price": 73893, "img": "item_005.png"}, {"id": 6, "name": "Libro 06", "section": "libros", "genero": "todos", "subcat": "todos", "price": 68618, "img": "item_006.png"}, {"id": 7, "name": "Libro 07", "section": "libros", "genero": "todos", "subcat": "todos", "price": 83046, "img": "item_007.png"}, {"id": 8, "name": "Zapatos Chica 08", "section": "ropa", "genero": "chica", "subcat": "zapatos", "price": 89597, "img": "item_008.png"}, {"id": 9, "name": "Libro 09", "section": "libros", "genero": "todos", "subcat": "todos", "price": 40189, "img": "item_009.png"}, {"id": 10, "name": "Sudadera Chico 10", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 57156, "img": "item_010.png"}, {"id": 11, "name": "Libro 11", "section": "libros", "genero": "todos", "subcat": "todos", "price": 36338, "img": "item_011.png"}, {"id": 12, "name": "Libro 12", "section": "libros", "genero": "todos", "subcat": "todos", "price": 85541, "img": "item_012.png"}, {"id": 13, "name": "Libro 13", "section": "libros", "genero": "todos", "subcat": "todos", "price": 69565, "img": "item_013.png"}, {"id": 14, "name": "Libro 14", "section": "libros", "genero": "todos", "subcat": "todos", "price": 82895, "img": "item_014.png"}, {"id": 15, "name": "Sudadera Chico 15", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 94615, "img": "item_015.png"}, {"id": 16, "name": "Correa Chico 16", "section": "ropa", "genero": "chico", "subcat": "correas", "price": 120674, "img": "item_016.png"}, {"id": 17, "name": "Sudadera Chica 17", "section": "ropa", "genero": "chica", "subcat": "sudaderas", "price": 131673, "img": "item_017.png"}, {"id": 18, "name": "Sudadera Chico 18", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 75512, "img": "item_018.png"}, {"id": 19, "name": "Correa Chico 19", "section": "ropa", "genero": "chico", "subcat": "correas", "price": 104429, "img": "item_019.png"}, {"id": 20, "name": "Libro 20", "section": "libros", "genero": "todos", "subcat": "todos", "price": 40659, "img": "item_020.png"}, {"id": 21, "name": "Libro 21", "section": "libros", "genero": "todos", "subcat": "todos", "price": 53283, "img": "item_021.png"}, {"id": 22, "name": "Sudadera Chico 22", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 124840, "img": "item_022.png"}, {"id": 23, "name": "Camisa Chica 23", "section": "ropa", "genero": "chica", "subcat": "camisas", "price": 105589, "img": "item_023.png"}, {"id": 24, "name": "Libro 24", "section": "libros", "genero": "todos", "subcat": "todos", "price": 47691, "img": "item_024.png"}, {"id": 25, "name": "Sudadera Chico 25", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 75021, "img": "item_025.png"}, {"id": 26, "name": "Zapatos Chico 26", "section": "ropa", "genero": "chico", "subcat": "zapatos", "price": 80093, "img": "item_026.png"}, {"id": 27, "name": "Correa Chica 27", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 72869, "img": "item_027.png"}, {"id": 28, "name": "Libro 28", "section": "libros", "genero": "todos", "subcat": "todos", "price": 55928, "img": "item_028.png"}, {"id": 29, "name": "Libro 29", "section": "libros", "genero": "todos", "subcat": "todos", "price": 39363, "img": "item_029.png"}, {"id": 30, "name": "Libro 30", "section": "libros", "genero": "todos", "subcat": "todos", "price": 39150, "img": "item_030.png"}, {"id": 31, "name": "Zapatos Chico 31", "section": "ropa", "genero": "chico", "subcat": "zapatos", "price": 121484, "img": "item_031.png"}, {"id": 32, "name": "Libro 32", "section": "libros", "genero": "todos", "subcat": "todos", "price": 53723, "img": "item_032.png"}, {"id": 33, "name": "Zapatos Chica 33", "section": "ropa", "genero": "chica", "subcat": "zapatos", "price": 56915, "img": "item_033.png"}, {"id": 34, "name": "Camisa Chica 34", "section": "ropa", "genero": "chica", "subcat": "camisas", "price": 127240, "img": "item_034.png"}, {"id": 35, "name": "Sudadera Chico 35", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 95432, "img": "item_035.png"}, {"id": 36, "name": "Libro 36", "section": "libros", "genero": "todos", "subcat": "todos", "price": 69052, "img": "item_036.png"}, {"id": 37, "name": "Libro 37", "section": "libros", "genero": "todos", "subcat": "todos", "price": 64676, "img": "item_037.png"}, {"id": 38, "name": "Libro 38", "section": "libros", "genero": "todos", "subcat": "todos", "price": 66256, "img": "item_038.png"}, {"id": 39, "name": "Correa Chica 39", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 145741, "img": "item_039.png"}, {"id": 40, "name": "Libro 40", "section": "libros", "genero": "todos", "subcat": "todos", "price": 37310, "img": "item_040.png"}, {"id": 41, "name": "Libro 41", "section": "libros", "genero": "todos", "subcat": "todos", "price": 58492, "img": "item_041.png"}, {"id": 42, "name": "Sudadera Chico 42", "section": "ropa", "genero": "chico", "subcat": "sudaderas", "price": 139646, "img": "item_042.png"}, {"id": 43, "name": "Libro 43", "section": "libros", "genero": "todos", "subcat": "todos", "price": 62806, "img": "item_043.png"}, {"id": 44, "name": "Correa Chica 44", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 128748, "img": "item_044.png"}, {"id": 45, "name": "Correa Chica 45", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 144943, "img": "item_045.png"}, {"id": 46, "name": "Correa Chica 46", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 109042, "img": "item_046.png"}, {"id": 47, "name": "Correa Chica 47", "section": "ropa", "genero": "chica", "subcat": "correas", "price": 85306, "img": "item_047.png"}, {"id": 48, "name": "Camisa Chica 48", "section": "ropa", "genero": "chica", "subcat": "camisas", "price": 119364, "img": "item_048.png"}, {"id": 49, "name": "Zapatos Chica 49", "section": "ropa", "genero": "chica", "subcat": "zapatos", "price": 54071, "img": "item_049.png"}, {"id": 50, "name": "Zapatos Chica 50", "section": "ropa", "genero": "chica", "subcat": "zapatos", "price": 117063, "img": "item_050.png"}];
  const grid = document.getElementById('grid');

  function cardTemplate(it){
    const detailUrl = `detalle.html?name=${encodeURIComponent(it.name)}&price=${it.price}&img=${encodeURIComponent('img/'+it.img)}`;
    return `
      <div class="col-md-4 col-sm-6 item"
           data-l1="${it.section}"
           data-genero="${it.genero}"
           data-sub="${it.subcat}"
           data-name="${it.name}">
        <div class="card h-100 shadow-sm" onclick="location.href='${detailUrl}'">
          <img src="img/${it.img}" class="card-img-top" alt="${it.name}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><a href="${detailUrl}" class="stretched-link text-decoration-none text-dark">${it.name}</a></h5>
            <p class="card-text">${it.section === 'ropa' ? 'Indumentaria institucional' : 'Material académico'}</p>
            <p class="price mb-3">${formatPrice(it.price)} COP</p>
            <div class="d-flex gap-2 mt-auto">
              <a href="${detailUrl}" class="btn btn-outline-primary w-100">Ver</a>
              <button type="button" class="btn btn-success w-100 add-btn" 
                      data-sku="SKU${it.id}"
                      data-name="${it.name}"
                      data-price="${it.price}"
                      data-img="${it.img}"
                      onclick="event.stopPropagation(); location.href='${detailUrl}'">Añadir al carrito</button>
            </div>
          </div>
        </div>
      </div>`;
  }

  function renderItems(list){
    grid.innerHTML = list.map(cardTemplate).join('');
  }
  renderItems(ITEMS);

  const selL1 = document.getElementById('selL1');
  const wrapGenero = document.getElementById('wrapGenero');
  const wrapSub = document.getElementById('wrapSubcat');
  const selGenero = document.getElementById('selGenero');
  const selSub = document.getElementById('selSub');
  const searchInput = document.getElementById('searchInput');

  function applyFilters(){
    const l1=selL1.value, gen=selGenero.value, sub=selSub.value, q=searchInput.value.trim().toLowerCase();
    document.querySelectorAll('#grid .item').forEach(c=>{
      const okL1=(l1==='todos'||c.dataset.l1===l1);
      const okGen=(l1!=='ropa'||gen==='todos'||c.dataset.genero===gen);
      const okSub=(l1!=='ropa'||sub==='todos'||c.dataset.sub===sub);
      const okQ=(!q||c.dataset.name.toLowerCase().includes(q));
      c.style.display=(okL1 && okGen && okSub && okQ)?'':'none';
    });
  }
  function toggleSecondary(){
    const show = selL1.value==='ropa';
    wrapGenero.style.display = show?'':'none';
    wrapSub.style.display = show?'':'none';
    if(!show){ selGenero.value='todos'; selSub.value='todos'; }
    applyFilters();
  }
  selL1.addEventListener('change', toggleSecondary);
  selGenero.addEventListener('change', applyFilters);
  selSub.addEventListener('change', applyFilters);
  searchInput.addEventListener('input', applyFilters);
  toggleSecondary();

  function renderCartPreview(){
    const list = document.getElementById('cartPreviewList');
    const countEl = document.getElementById('cartPreviewCount');
    const totalEl = document.getElementById('cartPreviewTotal');
    const cart = getCart();
    const cnt = cart.reduce((n,i)=>n+i.qty,0);
    countEl.textContent = cnt + (cnt===1 ? " ítem" : " ítems");
    totalEl.textContent = formatPrice(cart.reduce((s,i)=>s+i.price*i.qty,0)) + " COP";
    if (cart.length === 0){
      list.innerHTML = '<div class="p-3 text-center text-muted">Tu carrito está vacío.</div>';
      return;
    }
    list.innerHTML = cart.slice(0,8).map(it => `
      <div class="list-group-item">
        <div class="d-flex align-items-center gap-2">
          <img src="img/${it.img}" style="width:40px;height:40px;object-fit:cover;border:1px solid #ddd;border-radius:6px;">
          <div class="flex-grow-1">
            <div class="small">${it.name}</div>
            <div class="text-muted small">${it.talla||'—'} · x${it.qty}</div>
          </div>
          <div class="ms-auto small fw-semibold">${formatPrice(it.price*it.qty)}</div>
          <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeFromCart('${it.sku}')">x</button>
        </div>
      </div>
    `).join('');
  }
  window.renderCartPreview = renderCartPreview;
  renderCartPreview();

  // Añadir al carrito desde tarjeta
  document.addEventListener('click', function(e){
    const btn = e.target.closest('.add-btn');
    if(!btn) return;
    e.preventDefault();
    const card = btn.closest('.item');
    const name = card.dataset.name;
    const img = card.querySelector('img.card-img-top').getAttribute('src').replace('img/','');
    const priceText = card.querySelector('.price').textContent.replace(/[^0-9]/g,'');
    const price = parseInt(priceText || '0', 10);
    const sku = 'SKU-' + Math.floor(Math.random()*1e9);
    addToCart({ sku, name, price, qty:1, talla:'—', img });
    updateCartBadge();
    if (typeof renderCartPreview === 'function') renderCartPreview();
  }, false);

</script>
</body>
</html>
